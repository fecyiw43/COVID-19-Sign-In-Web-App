<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- initialisation -->
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- title of app -->
    <title>Keep Your Distance</title>

    <!-- bootstrap4 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous"/>

    <!-- w3school stylesheet -->
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="stylesheets/account.css" />
    <link rel="javascript" href="javascripts/account.js"/>
  </head>


  <!-- body -->
  <body class="background" onload="CheckId()">
    <!--logo & button style -->
    <div class="w3-bar w3-red w3-card w3-left-align w3-large">
    <a class="w3-bar-item w3-button w3-hide-medium w3-hide-large w3-right w3-padding-large w3-hover-white w3-large w3-red" href="javascript:void(0);" onclick="miniMenu()" title="Toggle Navigation Menu"><i class="fa fa-bars"></i></a>

      <!--logo-->
      <img class="w3-bar-item logo" src="images/wdc-project-logo.png" alt="KYD Logo">

      <!--buttons-->
      <div>
      <a href="kyd.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white" id="Kyd">Home</a>
      <a href="/check-in-history.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white" id="checkInHistory">Check-in-History</a>
      <a href="/venManage.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white" id="venueInfo">Venue information</a>
      <a href="/manage.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white" id="manage">Manage</a>
      <a href="/account.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-white" id="account">Account</a>
      <a href="/healthSignUp.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white" id="healthSignUp">Sign-up</a>
      <a href="/login.html" class="button-resize w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white" onclick="logout()">Log Out</a>
    </div>

    <!-- Navbar on small screens -->
    <div id="miniMenu" class="w3-bar-block w3-white w3-hide w3-hide-large w3-hide-medium w3-large">
      <a href="/kyd.html" class="w3-bar-item w3-button w3-padding-large" id="Kyd2">Home</a>
      <a href="/check-in-history.html" class="w3-bar-item w3-button w3-padding-large" id="checkInHistory2">Check-In History</a>
      <a href="/venManage.html" class="w3-bar-item w3-button w3-padding-large" id="venueInfo2">Venue Information</a>
      <a href="/manage.html" class="w3-bar-item w3-button w3-padding-large" id="manage2">Manage</a>
      <a href="/account.html" class="w3-bar-item w3-button w3-padding-large" id="account2">Account</a>
      <a href="/healthSignUp.html" class="w3-bar-item w3-button w3-padding-large" id="healthSignUp2">Sign-up</a>
      <a href="/login.html" class="w3-bar-item w3-button w3-padding-large" onclick="logout()">Log Out</a>
    </div>
    </div>

    <!--Account info-->
      <div class = "formBox check-in-table">
        <div class="row">
          <div class="col">
            <p>First Name:</p>
          </div>
          <div class="col">
            <p>Last Name:</p>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <input type="text" class="form-control" placeholder="John" id="Firstname">
          </div>
          <div class="col">
            <input type="text" class="form-control" placeholder="Smith" id="Lastname">
          </div>
        </div>
        <div class="row bottomRow">
          <div class="col">
            <p>Phone No.:</p>
          </div>
          <div class="col">
            <p>Email:</p>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <input type="text" class="form-control" placeholder="0488384921" id="phoneNumber">
          </div>
          <div class="col">
            <input type="text" class="form-control" placeholder="Example@example.com" id="Email">
          </div>
        </div>
        <div class="row bottomRow">
          <div class="col">
            <p>Password:</p>
          </div>
          <div class="col">
            <p></p>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <input type="text" class="form-control" id="Password">
          </div>
          <div class="col">

          </div>
        </div>
      <!--<input type="submit" value="Update" class="btn btn-primary centerButton" onclick="onUpdate()">-->
      <button class="btn btn-primary centerButton" onclick="updateUserInfo()">Update</button>
    </div>

    <!-- footer -->
    <footer>
      <div class="about_us">
      <ul>
        <LI>ABOUT US</LI>
        <li>
        <p>
            Aninda Lachlan Frank Thomas
        </p>
        </li>
        </ul>
        </div>

      <div class="link_ref">

        <a class="links" target="_blank"
        href="https://www.sahealth.sa.gov.au/wps/wcm/connect/public+content/sa+health+internet/conditions/infectious+diseases/covid-19/testing+and+tracing/contact+tracing/contact+tracing%22%3E">
          Visit SA Health for more information
        </a>
        </div>
        <div class="link_ref">
        <a class="links" target="_blank" href="mailto:aninda400@gmail.com">
           Queries? Contact us
          </a>
      </div>
    </footer>

    <script>

      // Used to toggle the menu on small screens when clicking on the menu button
      function miniMenu() {
        var x = document.getElementById("miniMenu");
        if (x.className.indexOf("w3-show") == -1) {
          x.className += " w3-show";
        } else {
          x.className = x.className.replace(" w3-show", "");
        }
      }

      function CheckId(){
          var xhttp = new XMLHttpRequest();

          xhttp.onreadystatechange = function() {
              if (this.readyState == 4 && this.status == 200) {
                var data = JSON.parse(this.responseText);
                var ID = data.ID;

                if(ID.includes("u")){
                  console.log("check u");
                  var x = document.getElementById("venueInfo");
                  x.style.display = "none";
                  x = document.getElementById("manage");
                  x.style.display = "none";
                  x = document.getElementById("healthSignUp");
                  x.style.display = "none";
                  x = document.getElementById("venueInfo2");
                  x.style.display = "none";
                  x = document.getElementById("manage2");
                  x.style.display = "none";
                  x = document.getElementById("healthSignUp2");
                  x.style.display = "none";
                }
                else if(ID.includes("h")){
                  console.log("check h");
                  var t = document.getElementById("venueInfo");
                  t.style.display = "none";
                  t = document.getElementById("checkInHistory");
                  t.style.display = "none";
                  t = document.getElementById("venueInfo2");
                  t.style.display = "none";
                  t = document.getElementById("checkInHistory2");
                  t.style.display = "none";

                }
                else if(ID.includes("v")){
                  console.log("check v");
                  var k = document.getElementById("manage");
                  k.style.display = "none";
                  k = document.getElementById("checkInHistory");
                  k.style.display = "none";
                  k = document.getElementById("healthSignUp");
                  k.style.display = "none";
                  k = document.getElementById("manage2");
                  k.style.display = "none";
                  k = document.getElementById("checkInHistory2");
                  k.style.display = "none";
                  k = document.getElementById("healthSignUp2");
                  k.style.display = "none";
                }
              else{
                alert("Your ID has no set user type!!!!");
              }
            }
            else if(this.readyState == 4 && this.status >= 400){
              alert("failed");
            }
          };

          xhttp.open("GET", "/GettingId", true);
          // xhttp.setRequestHeader("Content-type", "application/json");
          //Send JSON containing new account data.
          xhttp.send();
        }


        //AJAX to handle user account changes.
        function updateUserInfo() {

          //Check if any input was provided.
          if(document.getElementById("Firstname").value.length == 0 && document.getElementById("Lastname").value.length == 0
             && document.getElementById("phoneNumber").value.length == 0 && document.getElementById("Email").value.length == 0 && document.getElementById("Password").value.length == 0)
          {
            alert("No data provided!");
            return;
          }

          //Get values from input fields, set to NULL if no value provided.
          var newFirstName, newLastName, newPhoneNumber, newEmail, newPassword;

          newFirstName = document.getElementById("Firstname").value;
          newLastName = document.getElementById("Lastname").value;
          newPhoneNumber = document.getElementById("phoneNumber").value;
          newEmail = document.getElementById("Email").value;
          newPassword = document.getElementById("Password").value;

          if(document.getElementById("Firstname").value.length == 0)
          {
            newFirstName = 'NULL';
          }
          if(document.getElementById("Lastname").value.length == 0)
          {
            newLastName = 'NULL';
          }
          if(document.getElementById("phoneNumber").value.length == 0)
          {
            newPhoneNumber = 'NULL';
          }
          if(document.getElementById("Email").value.length == 0)
          {
            newEmail = 'NULL';
          }
          if(document.getElementById("Password").value.length == 0)
          {
            newPassword = 'NULL';
          }

          var newAccountData = {
            firstName: newFirstName,
            lastName: newLastName,
            phoneNumber: newPhoneNumber,
            email: newEmail,
            password: newPassword
          };

          var xhttp = new XMLHttpRequest();
          xhttp.onreadystatechange = function() {
            if(this.readyState == 4 && this.status == 200) {
              alert("Succesfully updated account information.");
              location.reload();
            }
          };
          xhttp.open("POST", "/updateAccountInfo", true);
          xhttp.setRequestHeader("Content-type", "application/json");
          xhttp.send(JSON.stringify(newAccountData));
        }


        function logout(){

            // Create AJAX Request
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.open("POST", "/logout", true);
            xmlhttp.send();
        }

    </script>

  </body>
</html>